<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
<title>SvgEditor</title>
<link rel="stylesheet" href="../css/svgdrawer.css">
<link rel='stylesheet' href='../css/colpick.css'>
<script src='../js/jquery.min.js'></script>
<script src='../js/jquery-ui.min.js'></script>
<script src='../js/colpick.js'></script>
<style>
    svg { border: 1px solid #ccc; margin: 10px; cursor: pointer; }
.highlight { outline: 2px dashed red; }
#pickerContainer { margin-top: 20px; }
#output { margin-top: 10px; font-family: monospace; background: #f0f0f0; padding: 10px; border: 1px dashed #aaa; }
.range-group { margin-top: 10px; display: none; }
.range-value { font-weight: bold; margin-left: 10px; }
#svgSourceDisplay { display: none; margin-top: 10px; background: #eef; padding: 10px; border: 1px dashed #99c; white-space: pre-wrap; }
button { margin-right: 10px; margin-top: 10px; }
 </style>
</head><body><div id="top">
<table><tr>
<td><p id="reset">Clear</p></td>
<td><p id="sizeDisplay">Svg-Drawer</p></td>
<td><p id="menu">Tutup ‚ùå</p></td>
</tr><tr>
<td>Stroke Width:<span class="range-value" for="pSize">5</span>
<input class="input-range" type="range" id="pSize" value="5" min="1" max="50"></td>
<td>Duration: <span class="range-value">10</span>
<input class="input-range" type="range" id="dur" value="10" min="1" max="30"></td>
</tr><tr>
<td>Stroke:<input type="color" id="pSc" value="#000000"></td>
<td><p id="none">Nf-Color</p></td>
<td>Fill: <input type="color" id="pFill" value="#00ffff"></td>
</tr></table></div>
<div id="resizable">
<div id="handle">‚ñí</div>

<svg xmlns="http://www.w3.org/2000/svg" id="svg">
<path id="path" d="M 154 141 L 152 137 L 148 129 L 144 119 L 139 110 L 133 101 L 126 92 L 119 84 L 110 78 L 102 74 L 95 73 L 88 73 L 80 74 L 72 78 L 65 84 L 59 90 L 56 97 L 54 107 L 53 117 L 55 128 L 58 138 L 63 148 L 69 157 L 77 163 L 87 169 L 98 174 L 108 179 L 116 182 L 123 186 L 129 189 L 134 192 L 139 195 L 144 199 L 149 203 L 153 207 L 157 210 L 160 212 L 162 214 L 163 215 L 164 216 L 165 216 L 166 216 L 166 216 L 167 216 L 166 216 L 167 214 L 167 212 L 168 207 L 170 199 L 172 187 L 177 174 L 181 163 L 186 156 L 191 149 L 196 143 L 203 135 L 211 127 L 219 118 L 225 110 L 230 102 L 234 94 L 236 86 L 237 80 L 236 75 L 235 70 L 234 66 L 232 62 L 230 58 L 227 54 L 223 50 L 219 48 L 214 46 L 208 45 L 201 45 L 192 47 L 183 51 L 175 57 L 167 63 L 161 71 L 156 81 L 152 94 L 148 107 L 146 118 L 146 127 L 146 130"/>
</svg>

</div></div>
<div class="content">
<table><tr>
<td><h3>Text Animation</h3></td>
<td><p id="dld">Download</p></td>
</tr><tr>
<td>FontSize: <span class="range-value">14</span>
<input class="input-range" type="range" id="tFs" value="14" min="1" max="100"></td>
</tr><tr>
<td>Text: <input type="text" id="tAc" value="Gooo!  üèé üèç üöó üõµ "></td>
<td>Text Fill: <input type="color" id="tFc" value="#000000"></td></tr></table>

<svg xmlns="http://www.w3.org/2000/svg"
     xmlns:xlink="http://www.w3.org/1999/xlink"
     width="300"
     height="150"
     viewBox="0 0 300 150">
  <path id="path" stroke="#000" fill="none" />
  <text font-size="200" fill="#000">
    <textPath xlink:href="#path" id="textPath" startOffset="0%">
      Gooo! üèé üèç üöó üõµ
    </textPath>
  </text>
  <animate xmlns:xlink="http://www.w3.org/1999/xlink"
           xlink:href="#textPath"
           attributeName="startOffset"
           from="100%" to="-50%"
           repeatCount="indefinite"
           dur="10s" />
</svg>

<table><tr>
<td><h3>Circle Animation</h3></td>
<td><p id="dld">Download</p></td>
</tr><tr>
<td>Stroke width: <span class="range-value">5</span>
<input class="input-range" type="range" id="cSw" value="5" min="1" max="50"></td>
<td>Radius size: <span class="range-value">5</span>
<input class="input-range" type="range" id="circleR" value="5" min="1" max="50"></td>
</tr><tr>
<td>Stroke: <input type="color" id="cSc" value="#c26936"></td>
<td>Fill: <input type="color" id="cFill" value="#00ff00"></td>
</tr></table>

<svg xmlns="http://www.w3.org/2000/svg" id="svg3">
<path id="path"/>
<circle id="circle" cx="0" cy="0">
<animateMotion dur="7" repeatCount="indefinite">
<mpath href="#path"/>
</animateMotion>
</circle>
</svg>
<p id="panjang"></p></div>
</div>
<script src='../js/svgdrawer.js'></script>

</html>
<script>
let targetEl = null;

const ATTR_MAP = {
  svg: ['width', 'height', 'viewBox'],
  circle: ['fill', 'stroke', 'stroke-width', 'r'],
  rect: ['fill', 'stroke', 'stroke-width', 'width', 'height'],
  path: ['fill', 'stroke', 'stroke-width'],
  text: ['fill', 'stroke', 'font-size'],
  line: ['stroke', 'stroke-width', 'x1', 'y1', 'x2', 'y2'],
  ellipse: ['fill', 'stroke', 'stroke-width', 'rx', 'ry'],
  polygon: ['fill', 'stroke', 'stroke-width'],
  polyline: ['fill', 'stroke', 'stroke-width'],
  textpath: ['startOffset', 'href', 'fill', 'stroke', 'font-size']
};

const injectHtml = `<div id="pickerContainer">
  <div id="output">Klik elemen SVG untuk melihat atribut dan mulai injeksi...</div>
  <button id="toggleSourceBtn">üîçSource</button>
  <button id="copySourceBtn">üìã Copy</button>
  <button id="downloadSvgBtn">üíæ Download</button>
  <pre id="svgSourceDisplay"></pre>
  <fieldset>
    <legend>Target Atribut:</legend>
    <div id="attrRadioGroup">
      <!-- Radio dinamis akan dimasukkan di sini -->
    </div>
  </fieldset>
  <div class="range-group" id="rangeGroup">
    <label for="sizeRange">Ukuran:</label>
    <input class="input-range" type="range" id="sizeRange" value="5" min="1" max="1000">
    <span class="range-value" id="rangeValue">5</span>
  </div>
  <div id="picker"></div>
</div>`;

function injectPanel(html) {
  $('.inject-container').remove();
  const $inject = $('<div class="inject-container"></div>').html(html);
  $(targetEl).closest('svg').after($inject);
  initLivePanel();
}

function renderAttrRadios(tagName) {
  const attrs = ATTR_MAP[tagName] || [];
  const $container = $('#attrRadioGroup');
  $container.empty();

  if (attrs.length === 0) {
    $container.append('<p>(Tidak ada atribut yang bisa dimodifikasi)</p>');
    return;
  }

  attrs.forEach(attr => {
    const id = `attr-${attr}`;
    const radio = `
      <label for="${id}">
        <input type="radio" name="attrTarget" value="${attr}" id="${id}">
        ${attr}
      </label>
    `;
    $container.append(radio);
  });

  $container.find('input[name="attrTarget"]').first().prop('checked', true).trigger('change');
}

function initLivePanel() {
  const tag = targetEl.tagName.toLowerCase();
  const attrs = Array.from(targetEl.attributes).map(attr => `${attr.name}="${attr.value}"`);
  $('#output').text(`üéØ Target: <${tag}>\n${attrs.join('\n') || '(tidak ada atribut)'}`);
  renderAttrRadios(tag);
  updateLiveSource();

  $('input[name="attrTarget"]').off('change').on('change', function () {
  const attr = $(this).val();
  const isSizeAttr = ['stroke-width', 'r', 'font-size', 'width', 'height', 'rx', 'ry'].includes(attr);
  const isViewBox = attr === 'viewBox';

  $('#rangeGroup').toggle(isSizeAttr);
  $('#viewBoxGroup').remove(); // bersihkan dulu

  if (isViewBox) {
    const currentVal = $(targetEl).attr('viewBox') || '';
    const viewBoxInput = `
      <div id="viewBoxGroup">
        <label for="viewBoxInput">ViewBox:</label>
        <input type="text" id="viewBoxInput" value="${currentVal}" placeholder="contoh: 0 0 100 100">
      </div>
    `;
    $('#picker').before(viewBoxInput);

    $('#viewBoxInput').on('input', function () {
      const val = this.value;
      $(targetEl).attr('viewBox', val);
      $('#output').text(`\nüß≠ viewBox diubah ke "${val}"`);
      updateLiveSource();
    });
  }
});

  $('#picker').colpick({
    flat: true,
    layout: 'hex',
    submit: 0,
    color: 'ff0000',
    onChange: function(hsb, hex, rgb, el, bySetColor) {
      if (targetEl) {
        const attr = $('input[name="attrTarget"]:checked').val();
        const isSizeAttr = ['stroke-width', 'r', 'font-size', 'width', 'height', 'rx', 'ry'].includes(attr);
        if (!isSizeAttr) {
          $(targetEl).attr(attr, '#' + hex);
          $('#output').text(`\nüé® ${attr} diubah ke #${hex}`);
          updateLiveSource();
        }
      }
    }
  });

  $('#sizeRange').off('input').on('input', function () {
    const val = this.value;
    $('#rangeValue').text(val);
    const attr = $('input[name="attrTarget"]:checked').val();
    if (targetEl && ['stroke-width', 'r', 'font-size', 'width', 'height', 'rx', 'ry'].includes(attr)) {
      $(targetEl).attr(attr, val);
      $('#output').text(`\nüìè ${attr} diubah ke ${val}`);
      updateLiveSource();
    }
  });

  $('#toggleSourceBtn').off('click').on('click', function () {
    $('#svgSourceDisplay').slideToggle();
    updateLiveSource();
  });

  $('#copySourceBtn').off('click').on('click', function () {
    const svgRoot = $(targetEl).closest('svg')[0];
    if (svgRoot) {
      const svgText = svgRoot.outerHTML;
      navigator.clipboard.writeText(svgText).then(() => {
        alert('‚úÖ SVG berhasil disalin ke clipboard!');
      }).catch(err => {
        alert('‚ùå Gagal menyalin: ' + err);
      });
    } else {
      alert('‚ö†Ô∏è Tidak ada elemen SVG yang dipilih.');
    }
  });

  $('#downloadSvgBtn').off('click').on('click', function () {
    const svgRoot = $(targetEl).closest('svg')[0];
    if (svgRoot) {
      const svgText = svgRoot.outerHTML;
      const svgBlob = new Blob([svgText], { type: 'image/svg+xml;charset=utf-8' });
      const url = URL.createObjectURL(svgBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'injected-svg.svg';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    } else {
      alert('‚ö†Ô∏è Tidak ada elemen SVG yang dipilih.');
    }
  });
}

function updateLiveSource() {
  const svgRoot = targetEl ? $(targetEl).closest('svg')[0] : null;
  const svgContent = svgRoot ? svgRoot.outerHTML : '(SVG tidak ditemukan)';
  $('#svgSourceDisplay').text(svgContent);
}
$(document).on('click', 'svg, svg *', function (e) {
  e.stopPropagation();
  $('svg,svg *').removeClass('highlight');
  $(this).addClass('highlight');

  let clickedEl = this;
  let tag = clickedEl.tagName.toLowerCase();

  // ‚úÖ Jika klik <textPath>, fallback ke parent <text>
  if (tag === 'textpath') {
    const parentText = $(clickedEl).closest('text')[0];
    if (parentText) {
      targetEl = parentText;
      console.log('üéØ Fallback ke <text> dari <textPath>');
    } else {
      targetEl = clickedEl; // fallback tetap ke <textPath> kalau gak ada <text>
    }
  } else {
    targetEl = clickedEl;
  }

  injectPanel(injectHtml);
});

$(document).ready(function () {
  setupSVGClickHandler();
});
</script>
